[INGEST:vendor="msft", product="azure", target_dataset="msft_azure_firewall_raw", no_hit = drop]
// assert log record is an Azure Firewall log with a RFC 3339 compatible timestamp; e.g., 2024-11-13T17:07:26.458400+03:00. 
filter category in ("AZFWApplicationRule", "AZFWApplicationRuleAggregation", "AZFWDnsQuery", "AZFWFatFlow", "AZFWFlowTrace", "AZFWFqdnResolveFailure", "AZFWInternalFqdnResolutionFailure", "AZFWIdpsSignature", "AZFWNatRule", "AZFWNatRuleAggregation", "AZFWNetworkRule", "AZFWNetworkRuleAggregation", "AZFWThreatIntel") 
    and to_string(time) ~= "\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|[+-]\d{2}:\d{2})"
| alter _time = if(to_string(time) ~= "Z$",
    parse_timestamp("%FT%H:%M:%E*SZ", to_string(time)), // zulu time notation, e.g. "2024-09-24T16:41:59.698Z
    parse_timestamp("%FT%H:%M:%E*S%Ez", to_string(time))); // numerical offset e.g. 2024-09-24T19:41:59.698+03:00